# Cafe Cards App - TODO List

## üöÄ High Priority Features

### Authentication & User Management
- [ ] Implement user registration validation
- [ ] Add email verification flow
- [ ] Implement forgot password functionality
- [ ] Add user profile picture upload
- [ ] Implement account deletion feature

### Core Functionality
- [x] Implement actual QR code scanning (COMPLETED)
- [x] Add QR code generation for customers (COMPLETED)
- [x] Implement QR code display with theming (COMPLETED)
- [x] Add customer loyalty card QR with proper data format (COMPLETED)
- [x] Update scanner to handle new QR format (COMPLETED)
- [x] Implement Appwrite database integration for scanned cards (COMPLETED)
- [x] Create loyalty card data model and storage (COMPLETED)
- [ ] Implement points/rewards system logic
- [ ] Add card expiration handling

### Database & Backend
- [x] Set up Appwrite collections for loyalty cards (COMPLETED)
- [x] Implement real-time card updates (COMPLETED)
- [x] Add Appwrite integration for card scanning and storage (COMPLETED)
- [ ] Set up Appwrite collections for:
  - [ ] User profiles
  - [ ] Cafes/businesses
  - [ ] Transactions/scans
- [ ] Add data synchronization between devices

## üé® UI/UX Improvements

### Profile Screen
- [x] Password change modal (COMPLETED)
- [x] Theme support (COMPLETED)
- [x] Role-based UI (COMPLETED)
- [x] Global debug toggle for cafe/customer switching (COMPLETED)
- [x] Auto-set debug toggle based on real user type (COMPLETED)
- [x] Extract reusable components (StatCard, ProfileOption, DebugToggle, PasswordModal) (COMPLETED)
- [ ] Add profile picture upload
- [ ] Implement settings persistence
- [ ] Add success/error toast notifications

### Cards Screen
- [x] Modern card layout (COMPLETED)
- [x] Implement real loyalty card display from Appwrite database (COMPLETED)
- [x] Add pull-to-refresh functionality (COMPLETED)
- [x] Role-based card display (customers vs cafe owners) (COMPLETED)
- [x] Customer card visibility - customers can now see their own loyalty cards (COMPLETED)
- [ ] Add card search/filter functionality
- [ ] Implement card sorting options
- [ ] Create add new card flow

### Camera/Scanner Screen
- [x] Implement actual camera functionality (COMPLETED)
- [x] Add QR code detection and processing (COMPLETED)
- [x] Create scan history (COMPLETED)
- [x] Add camera refresh functionality (COMPLETED)
- [x] Implement automatic camera refresh on page load (COMPLETED)
- [x] Update scanner to parse new QR code format (COMPLETED)

### QR Code Screen
- [x] Transform from card creation to QR display (COMPLETED)
- [x] Generate customer loyalty card QR codes (COMPLETED)
- [x] Implement theme-aware QR codes (black/white) (COMPLETED)
- [x] Add card ID copy functionality (COMPLETED)
- [x] Include comprehensive card data in QR (COMPLETED)
- [x] Add refresh QR functionality (COMPLETED)
- [x] Add manual card entry option (COMPLETED)
- [x] Implement scan feedback (success/error states) (COMPLETED)

### Settings Screen
- [ ] Make settings functional (currently UI-only)
- [ ] Add notification preferences
- [ ] Implement data export/import
- [ ] Add privacy controls

## üè™ Cafe Owner Features

### Business Management
- [ ] Cafe profile setup and editing
- [ ] Loyalty program configuration
- [ ] Reward tier management
- [ ] Customer analytics dashboard

### Card Management
- [ ] Bulk card generation
- [ ] Custom card designs
- [ ] Expiration date management
- [ ] Card activation/deactivation

### Analytics
- [ ] Customer engagement metrics
- [ ] Popular rewards tracking
- [ ] Revenue analytics
- [ ] Customer retention stats

## üì± Technical Improvements

### Performance
- [ ] Implement image caching for card logos
- [ ] Add loading states for all async operations
- [ ] Optimize bundle size
- [ ] Add error boundaries

### Code Quality
- [ ] Add comprehensive error handling
- [ ] Implement logging system
- [ ] Add unit tests
- [ ] Add integration tests
- [ ] Improve TypeScript coverage

### Accessibility
- [ ] Add accessibility labels
- [ ] Implement screen reader support
- [ ] Add high contrast mode
- [ ] Test with accessibility tools

## üîß Infrastructure

### Security
- [ ] Implement API rate limiting
- [ ] Add request validation
- [ ] Secure storage for sensitive data
- [ ] Implement proper session management

### Deployment
- [ ] Set up CI/CD pipeline
- [ ] Configure app store builds
- [ ] Add crash reporting (Sentry/Bugsnag)
- [ ] Set up analytics (Amplitude/Mixpanel)

## üéØ Nice-to-Have Features

### Social Features
- [ ] Share favorite cafes
- [ ] Review system for cafes
- [ ] Social login options
- [ ] Friend referral system

### Advanced Features
- [ ] Offline support
- [ ] Push notifications for offers
- [ ] Location-based cafe discovery
- [ ] Apple/Google Wallet integration

### Gamification
- [ ] Achievement system
- [ ] Leaderboards
- [ ] Special badges
- [ ] Streak tracking

## üêõ Known Issues to Fix

### Current Bugs
- [ ] Verify theme persistence across app restarts
- [ ] Test password change on different devices
- [ ] Ensure proper navigation after logout
- [ ] Fix any memory leaks in camera preview
- [x] Fix clipboard native module error (COMPLETED - switched to expo-clipboard)
- [x] Fix random "Document with the requested ID could not be found" errors (COMPLETED - added comprehensive error handling)

### Error Handling Improvements (COMPLETED)
- [x] Added defensive programming to prevent crashes on missing/invalid documents
- [x] Improved real-time subscription error handling with automatic retries
- [x] Added document validation and cleanup utilities
- [x] Enhanced Appwrite function error handling with specific error messages
- [x] Added card state validation to prevent corrupted data from causing crashes
- [x] Implemented graceful fallbacks for permission and network errors

### Edge Cases
- [ ] Handle network connectivity issues
- [ ] Manage app state during interruptions
- [ ] Test with empty states
- [ ] Handle large datasets gracefully

## üß© Code Architecture & Refactoring

### Component Extraction (COMPLETED)
- [x] StatCard component for displaying profile statistics
- [x] ProfileOption component for settings menu items
- [x] DebugToggle component for development mode switching
- [x] PasswordModal component for password change functionality
- [x] Improved modularity and reusability of profile screen components

### Pending Code Improvements
- [ ] Extract common form components (TextInput, Button variations)
- [ ] Create a centralized navigation helper
- [ ] Implement error boundary components
- [ ] Add proper TypeScript types throughout the app
- [ ] Optimize performance with React.memo and useMemo where needed

## üìã Testing Checklist

### Manual Testing
- [ ] Test all navigation flows
- [ ] Verify theme switching works correctly
- [ ] Test on different screen sizes
- [ ] Test on both iOS and Android

### Automated Testing
- [ ] Set up Jest testing environment
- [ ] Write component tests for ThemedComponents
- [ ] Add integration tests for user flows
- [ ] Set up E2E testing with Detox

## üìù Documentation

- [ ] Create API documentation
- [ ] Write user guide/help section
- [ ] Document component library
- [ ] Create developer setup guide

---

## Priority Order
1. **Phase 1**: Core functionality (QR scanning, data storage)
2. **Phase 2**: Business features (cafe owner tools)
3. **Phase 3**: Polish and advanced features
4. **Phase 4**: Social and gamification features

Last updated: July 5, 2025

## ‚úÖ Recent Completion - Appwrite Database Integration

### What was implemented:
- **Scanner-Database Integration**: When cafe users scan customer QR codes, loyalty cards are now automatically saved to Appwrite database
- **Card Management Functions**: Created comprehensive Appwrite functions for creating, updating, and querying loyalty cards
- **Real-time Card Display**: Cards screen now displays actual loyalty cards from the database with real-time updates
- **Role-based Views**: Different card displays for cafe users (showing customer cards they manage) vs regular customers
- **Error Handling**: Proper error handling for database operations with fallback to local storage
- **Data Structure**: Complete loyalty card data model with stamps, rewards, customer info, and scan history

### Files modified:
- `lib/appwrite.js` - Added loyalty card management functions
- `app/(dashboard)/cafeCamera.jsx` - Added database integration to scanner
- `app/(dashboard)/cards.jsx` - Updated to display real loyalty cards from database
- `contexts/CardsContext.jsx` - Created context for loyalty card management
- `hooks/useCards.js` - Added hook for accessing cards context
- `APPWRITE_SETUP.md` - Created setup instructions for Appwrite collection

### Next steps needed:
1. Create the loyalty_cards collection in Appwrite console using the instructions in APPWRITE_SETUP.md
2. Update the LOYALTY_CARDS_COLLECTION_ID in lib/appwrite.js with the actual collection ID
3. Test the scanner and cards functionality end-to-end
